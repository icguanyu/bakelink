import{_ as N,r as w,l as A,x as S,o as a,w as r,b as e,c as u,v as k,d,f as L,h as p,F as B,y as j,t as i,W as R,D as F,n as M,R as H,J,g as E,m as z,X as W,Y as X,q as Y}from"./index-BbS6ciBb.js";/* empty css               *//* empty css               *//* empty css                     */import{_ as G}from"./SelectProduct-Bqy1XsdJ.js";const K={class:"order-detail"},Q={class:"items-section"},Z={class:"section-header"},ee={key:0,class:"items-table"},te={class:"item-name-section"},se={class:"item-price-section"},oe={class:"price"},le={class:"item-quantity-section"},ne={key:1,class:"no-items"},de={class:"total-section"},ae={class:"total-row"},ie={class:"amount"},re={key:0,class:"add-product-section"},ue={class:"add-product-header"},ce={class:"add-product-row"},me={__name:"OrderDetail",props:{order:{type:Object,required:!0}},emits:["close","update-items"],setup(o,{expose:T,emit:D}){const f=w(!1),x=w(null),_=w(""),V=o,C=D,$=w(!1),v=w([]),P=()=>{v.value=V.order?.items?V.order.items.map(n=>({...n})):[]};V.order?.items&&P();const U=(n,s)=>{s>0&&(v.value[n].quantity=parseInt(s))},I=n=>{v.value.splice(n,1)},h=()=>{if(!_.value||!x.value)return;const n=x.value.getProductById(_.value);if(!n)return;const s=v.value.find(y=>y.id===n.id);s?s.quantity+=1:v.value.push({id:n.id,name:n.name,price:n.price,quantity:1}),_.value="",f.value=!1},l=A(()=>v.value.reduce((n,s)=>n+s.price*s.quantity,0)),t=()=>{$.value=!1,C("close")},b=()=>{C("update-items",v.value),$.value=!1,C("close")};return T({visible:$}),(n,s)=>{const y=L,g=R,O=F;return a(),S(O,{center:"",modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=c=>$.value=c),title:"訂購明細",width:"75%",onClose:t,class:"order-detail-dialog"},{footer:r(()=>[d(y,{onClick:t},{default:r(()=>[...s[13]||(s[13]=[p("取消",-1)])]),_:1}),d(y,{type:"primary",onClick:b},{default:r(()=>[...s[14]||(s[14]=[p("確認",-1)])]),_:1})]),default:r(()=>[e("div",K,[e("div",Q,[e("div",Z,[s[5]||(s[5]=e("h3",null,"訂購項目",-1)),d(y,{type:"success",onClick:s[0]||(s[0]=c=>f.value=!0)},{default:r(()=>[...s[4]||(s[4]=[p(" 新增項目 ",-1)])]),_:1})]),v.value.length>0?(a(),u("div",ee,[(a(!0),u(B,null,j(v.value,(c,m)=>(a(),u("div",{key:m,class:"item-card"},[s[8]||(s[8]=e("div",{class:"item-image-section"},null,-1)),e("div",te,i(c.name),1),e("div",se,[s[6]||(s[6]=e("span",{class:"label"},"單價:",-1)),e("span",oe,"$"+i(c.price),1)]),e("div",le,[s[7]||(s[7]=e("span",{class:"quantity-label"},"數量:",-1)),d(g,{modelValue:c.quantity,"onUpdate:modelValue":q=>c.quantity=q,min:1,max:999,onChange:q=>U(m,q)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),d(y,{size:"small",icon:"delete",type:"danger",plain:"",onClick:q=>I(m)},null,8,["onClick"])]))),128))])):(a(),u("div",ne,"沒有訂購項目"))]),e("div",de,[e("div",ae,[s[9]||(s[9]=e("span",{class:"label"},"訂單總計：",-1)),e("span",ie,"$"+i(l.value),1)])]),f.value?(a(),u("div",re,[e("div",ue,[s[11]||(s[11]=e("h4",null,"新增產品",-1)),d(y,{text:"",onClick:s[1]||(s[1]=c=>f.value=!1)},{default:r(()=>[...s[10]||(s[10]=[p("關閉",-1)])]),_:1})]),e("div",ce,[d(G,{ref_key:"selectProductRef",ref:x,modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=c=>_.value=c),class:"flex-1"},null,8,["modelValue"]),d(y,{type:"primary",disabled:!_.value,onClick:h},{default:r(()=>[...s[12]||(s[12]=[p(" 新增 ",-1)])]),_:1},8,["disabled"])])])):k("",!0)])]),_:1},8,["modelValue"])}}},ve=N(me,[["__scopeId","data-v-4ccdb844"]]),pe={class:"order-header"},fe={class:"order-id-section"},ye={class:"order-id"},ke={class:"id-prefix"},_e={class:"id-highlight"},be={class:"order-customer"},$e={class:"info-row"},Ce={class:"info-label"},ge={class:"info-value"},qe={key:0,class:"info-row"},we={class:"info-label"},xe={class:"info-value"},Ve={key:1,class:"info-row"},Ie={class:"info-label"},De={class:"info-value pickup-time"},Pe={key:0,class:"pickup-date"},Me={key:0,class:"order-items"},ze={class:"items-header"},Se={class:"items-list"},Te={class:"item-name"},Ue={class:"item-quantity"},he={class:"item-price"},Oe={key:1,class:"order-note"},Be={class:"note-label"},Ee={class:"note-content"},Ne={class:"order-footer"},Ae={class:"footer-info"},Le={key:0,class:"payment-method"},je={class:"order-total"},Re={class:"total-amount"},Fe={__name:"OrderCard",props:{order:{type:Object,required:!0},viewMode:{type:String,required:!0}},emits:["open","status-change"],setup(o,{emit:T}){const D=w(null),f=o,x=[{label:"全部",value:"all",color:""},{label:"已下單",value:"ordered",color:"#3b82f6",count:0},{label:"已完成",value:"completed",color:"#10b981",count:0},{label:"已取消",value:"cancelled",color:"#ef4444",count:0}],_=T,V=l=>({ordered:"已下單",completed:"已完成",cancelled:"已取消"})[l]||l,C=l=>x.find(b=>b.value===l)?.color||"#6b7280",$=l=>({cash:"現金",bank:"匯款",linepay:"Line Pay",card:"信用卡"})[l]||l,v=l=>z(l).isSame(z(),"day"),P=A(()=>{const l=f.order?.id||"",t=l.slice(-3);return{prefix:l.slice(0,-3),lastThree:t}}),U=()=>{_("open",f.order.id)},I=l=>{_("status-change",f.order,l)},h=l=>{f.order.items=l,f.order.totalAmount=l.reduce((t,b)=>t+b.price*b.quantity,0)};return(l,t)=>{const b=M("User"),n=J,s=M("Phone"),y=M("AlarmClock"),g=L,O=M("Document"),c=W;return a(),u(B,null,[e("div",{class:Y(["order-card",{"simple-mode":o.viewMode==="simple"}]),onClick:U},[t[17]||(t[17]=e("div",{class:"order-ticket-top"},null,-1)),e("div",pe,[e("div",fe,[t[5]||(t[5]=e("div",{class:"order-label"},"訂單編號",-1)),e("div",ye,[e("span",ke,i(P.value.prefix),1),e("span",_e,i(P.value.lastThree),1)])]),e("div",{class:"order-status-stamp",style:H({borderColor:C(o.order.status),color:C(o.order.status)})},[e("span",null,i(V(o.order.status)),1)],4)]),e("div",be,[e("div",$e,[e("div",Ce,[d(n,null,{default:r(()=>[d(b)]),_:1}),t[6]||(t[6]=e("span",null,"顧客",-1))]),e("span",ge,i(o.order.customerName),1)]),o.viewMode==="detailed"?(a(),u("div",qe,[e("div",we,[d(n,null,{default:r(()=>[d(s)]),_:1}),t[7]||(t[7]=e("span",null,"電話",-1))]),e("span",xe,i(o.order.phone),1)])):k("",!0),o.viewMode==="detailed"?(a(),u("div",Ve,[e("div",Ie,[d(n,null,{default:r(()=>[d(y)]),_:1}),t[8]||(t[8]=e("span",null,"取貨",-1))]),e("span",De,[v(o.order.pickupTime)?k("",!0):(a(),u("span",Pe,i(E(z)(o.order.pickupTime).format("MM/DD")),1)),p(" "+i(E(z)(o.order.pickupTime).format("HH:mm")),1)])])):k("",!0)]),t[18]||(t[18]=e("div",{class:"order-divider"},null,-1)),o.viewMode==="detailed"?(a(),u("div",Me,[e("div",ze,[t[10]||(t[10]=e("span",null,"訂購明細",-1)),d(g,{type:"primary",size:"small",onClick:t[0]||(t[0]=m=>D.value.visible=!0)},{default:r(()=>[...t[9]||(t[9]=[p("詳細",-1)])]),_:1})]),e("div",Se,[(a(!0),u(B,null,j(o.order.items,(m,q)=>(a(),u("div",{key:q,class:"order-item"},[e("span",Te,i(m.name),1),e("span",Ue,"× "+i(m.quantity),1),e("span",he,"$"+i(m.price*m.quantity),1)]))),128)),e("pre",null,i(o.order.items),1)])])):k("",!0),o.viewMode==="detailed"&&o.order.note?(a(),u("div",Oe,[e("div",Be,[d(n,null,{default:r(()=>[d(O)]),_:1}),t[11]||(t[11]=e("span",null,"備註",-1))]),e("div",Ee,i(o.order.note),1)])):k("",!0),e("div",Ne,[e("div",Ae,[o.viewMode==="detailed"?(a(),u("div",Le,[t[12]||(t[12]=e("span",{class:"label"},"付款方式",-1)),d(c,{size:"small",type:"info"},{default:r(()=>[p(i($(o.order.payment)),1)]),_:1})])):k("",!0)]),e("div",je,[t[13]||(t[13]=e("span",{class:"total-label"},"總計",-1)),e("span",Re,"$"+i(o.order.totalAmount),1)])]),e("div",{class:"order-actions",onClick:t[4]||(t[4]=X(()=>{},["stop"]))},[o.order.status==="ordered"?(a(),S(g,{key:0,type:"danger",plain:"",size:"small",onClick:t[1]||(t[1]=m=>I("cancelled"))},{default:r(()=>[...t[14]||(t[14]=[p(" 取消訂單 ",-1)])]),_:1})):k("",!0),o.order.status==="ordered"?(a(),S(g,{key:1,class:"complete",type:"success",size:"small",onClick:t[2]||(t[2]=m=>I("completed"))},{default:r(()=>[...t[15]||(t[15]=[p(" 完成訂單 ",-1)])]),_:1})):k("",!0),o.order.status==="completed"||o.order.status==="cancelled"?(a(),S(g,{key:2,type:"primary",plain:"",size:"small",onClick:t[3]||(t[3]=m=>I("ordered"))},{default:r(()=>[...t[16]||(t[16]=[p(" 復原為已下單 ",-1)])]),_:1})):k("",!0)]),t[19]||(t[19]=e("div",{class:"order-ticket-bottom"},null,-1))],2),d(ve,{ref_key:"orderDetail",ref:D,order:o.order,onUpdateItems:h},null,8,["order"])],64)}}},Ge=N(Fe,[["__scopeId","data-v-3f9d476a"]]);export{Ge as _};

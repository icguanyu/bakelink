import{_ as T,r as y,a as j,x as S,o as r,w as i,b as u,y as Y,c as b,g as e,F as L,z,d as l,t as P,f as H,A as Z,B as ee,j as le,E as te,e as oe,h as M,C as R,D as ae,G as ve,H as O,I as fe,l as ne,n as J,v as B,J as K,q as A,k as W,K as se,L as ie,M as de,N as ue,O as ye,P as Ve,Q as be,R as X}from"./index-BxJShhSS.js";/* empty css               */import{P as I,a as G}from"./products-Dn-UQg2U.js";/* empty css            *//* empty css               */const he={class:"layout"},ke={class:"list"},Ce={key:0,class:"chips"},$e={class:"chip__title"},we={class:"form"},Ue={__name:"EditCategory",emits:["save"],setup(C,{expose:x,emit:V}){const n=y(!1),s=y(!1),d=y([]);y([]);const h=j({page:null,limit:null,keyword:""}),c=j({name:""}),o=()=>{s.value=!0},_=()=>{s.value=!1},w=async()=>{n.value=!0;try{const k=await I.Create(c);O({title:"成功",message:"已新增種類",type:"success"}),c.name="",await v()}catch(k){console.log("catch",k)}finally{n.value=!1}},g=k=>{ve.confirm("確定要刪除這個種類嗎？","警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(async()=>{n.value=!0;try{await I.Delete(k),O({title:"成功",message:"已刪除種類",type:"success"}),await v()}catch(m){console.log("catch",m)}finally{n.value=!1}}).catch(()=>{})};x({open:o,close:_});const v=async()=>{n.value=!0;try{const k=await I.List(h);console.log("res",k),d.value=k.data.data}catch(k){console.log("fetch categories error",k)}finally{n.value=!1}};return(k,m)=>{const p=H,t=Z,F=oe,U=te,E=le,f=ae,N=ee;return r(),S(f,{modelValue:e(s),"onUpdate:modelValue":m[1]||(m[1]=$=>R(s)?s.value=$:null),title:"編輯商品種類",width:"800px","append-to-body":"","destroy-on-close":"","close-on-click-modal":!1,onOpened:v},{footer:i(()=>[l(p,{onClick:_},{default:i(()=>[...m[5]||(m[5]=[M("返回",-1)])]),_:1})]),default:i(()=>[u("div",he,[Y((r(),b("section",ke,[m[2]||(m[2]=u("header",null,[u("h3",null,"現有種類"),u("small",null,"若種類被移除，原已存在的商品將被歸類為「未分類」")],-1)),e(d).length?(r(),b("div",Ce,[(r(!0),b(L,null,z(e(d),$=>(r(),b("div",{class:"chip",key:$.id},[u("div",$e,P($.name),1),l(p,{size:"small",icon:"Minus",circle:"",plain:"",onClick:Q=>g($.id)},null,8,["onClick"])]))),128))])):(r(),S(t,{key:1,description:"目前沒有種類"}))])),[[N,e(n)]]),u("section",we,[m[4]||(m[4]=u("header",null,[u("h3",null,"新增種類")],-1)),l(E,{model:e(c),"label-width":"60px","label-position":"top"},{default:i(()=>[l(U,{label:"名稱",prop:"name"},{default:i(()=>[l(F,{modelValue:e(c).name,"onUpdate:modelValue":m[0]||(m[0]=$=>e(c).name=$),placeholder:"輸入種類名稱"},null,8,["modelValue"])]),_:1}),l(U,null,{default:i(()=>[l(p,{type:"primary",onClick:w},{default:i(()=>[...m[3]||(m[3]=[M("新增",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1},8,["modelValue"])}}},xe=T(Ue,[["__scopeId","data-v-1bea777f"]]),Ee={class:"images-uploader"},Pe=["src","alt"],Se={class:"upload-text"},Be={class:"hint"},De={__name:"UploadPhotos",props:{modelValue:{type:Array,default:()=>[]},disabled:Boolean,max:{type:Number,default:4}},emits:["upload","delete","update:modelValue"],setup(C,{emit:x}){const V=C,n=x,s=y(!1),d=y([...V.modelValue]),h=async _=>{const w=Array.from(_.target.files),g=d.value.length,v=Math.min(w.length,V.max-g);if(v===0){W.warning(`最多只能上傳 ${V.max} 張圖片`);return}w.slice(0,v).forEach(m=>{const p=URL.createObjectURL(m);d.value.push(p),n("upload",p)}),n("update:modelValue",d.value),_.target.value="",v<w.length&&W.info(`已達上傳上限，共上傳 ${v} 張`)},c=_=>{d.value.splice(_,1),n("delete",_),n("update:modelValue",d.value)};fe(()=>V.modelValue,_=>{d.value=[..._]},{deep:!0});const o=ne(()=>d.value.length<V.max);return(_,w)=>{const g=J("Delete"),v=K;return r(),b("div",Ee,[u("div",{class:A(["gallery",{"has-images":d.value.length>0}])},[(r(!0),b(L,null,z(d.value,(k,m)=>(r(),b("div",{key:m,class:"image-item"},[u("img",{src:k,alt:`圖片 ${m+1}`},null,8,Pe),l(v,{class:"delete-btn",onClick:p=>c(m)},{default:i(()=>[l(g)]),_:1},8,["onClick"])]))),128)),o.value?(r(),b("label",{key:0,for:"image-upload",class:A([{disabled:s.value||C.disabled},"upload-box"])},[u("div",Se,P(s.value?"上傳中...":"上傳圖片"),1),u("small",null,P(d.value.length)+"/"+P(C.max),1)],2)):B("",!0)],2),u("small",Be,"建議尺寸 600x400，檔案小於 1MB，最多 "+P(C.max)+" 張",1),u("input",{type:"file",id:"image-upload",accept:".png,.jpg,.jpeg,.webp",multiple:"",onChange:h},null,32)])}}},Fe=T(De,[["__scopeId","data-v-77a54f16"]]),Me={__name:"SelectProductStatus",props:{modelValue:Boolean,placeholder:{type:String,default:"請選擇"}},emits:["update:modelValue"],setup(C,{emit:x}){const V=y([{value:!0,label:"啟用"},{value:!1,label:"下架"}]);return(n,s)=>{const d=se,h=ie;return r(),S(h,{modelValue:C.modelValue,onClear:s[0]||(s[0]=c=>n.$emit("update:modelValue",null)),"onUpdate:modelValue":s[1]||(s[1]=c=>n.$emit("update:modelValue",c)),placeholder:C.placeholder},{default:i(()=>[(r(!0),b(L,null,z(e(V),c=>(r(),S(d,{key:c.id,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])}}},Ie={__name:"SelectCategory",props:{modelValue:String,placeholder:{type:String,default:"請選擇種類"}},emits:["update:modelValue"],setup(C,{emit:x}){const V=y(!1),n=y([]),s=async()=>{V.value=!0;try{const d=await I.List();console.log("res",d),n.value=d.data.data}catch(d){console.log("fetch categories error",d)}finally{V.value=!1}};return de(()=>{s()}),(d,h)=>{const c=se,o=ie;return r(),S(o,{modelValue:C.modelValue,onClear:h[0]||(h[0]=_=>d.$emit("update:modelValue",null)),"onUpdate:modelValue":h[1]||(h[1]=_=>d.$emit("update:modelValue",_)),placeholder:C.placeholder,loading:e(V)},{default:i(()=>[(r(!0),b(L,null,z(e(n),_=>(r(),S(c,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])}}},Le={key:0},ze={key:1},Ne={class:"ing-table"},je={key:2},Re={__name:"EditProduct",emits:["update"],setup(C,{expose:x,emit:V}){const n=y(!1),s=y("基本資訊"),d=V,h=y(!1),c=y(null),o=j({id:null,name:"",category_id:"",price:0,description:"",ingredients:"",ingredient_details:[],imageUrls:[],is_active:!0}),_=()=>{X(()=>{c.value?.resetFields()})},w=(p={})=>{s.value="基本資訊",n.value=!0,p?.id?X(()=>{Object.assign(o,p)}):(o.id=null,_())},g=()=>{n.value=!1},v=async p=>{p.validate(t=>{if(t)k();else return})},k=async()=>{h.value=!0;try{let p;o.id?p=await G.Update(o.id,o):p=await G.Create(o),console.log("save product res",p),O({title:"成功",message:`商品已${o.id?"更新":"新增"}成功`,type:"success"}),g(),d("update")}catch(p){console.log("save product error",p)}finally{h.value=!1}},m=p=>{o.ingredient_details.splice(p,1)};return x({open:w,close:g}),(p,t)=>{const F=ue,U=oe,E=te,f=Ie,N=Me,$=Ve,Q=be,re=J("Delete"),ce=K,me=ye,q=H,pe=Fe,_e=le,ge=ae;return r(),S(ge,{modelValue:e(n),"onUpdate:modelValue":t[11]||(t[11]=a=>R(n)?n.value=a:null),title:e(o).id?"編輯商品":"新增商品",width:"800px","append-to-body":""},{footer:i(()=>[l(q,{onClick:g},{default:i(()=>[...t[14]||(t[14]=[M("取消",-1)])]),_:1}),l(q,{type:"primary",onClick:t[10]||(t[10]=a=>v(e(c))),loading:e(h)},{default:i(()=>[M(P(e(o).id?"儲存":"新增"),1)]),_:1},8,["loading"])]),default:i(()=>[l(F,{modelValue:e(s),"onUpdate:modelValue":t[0]||(t[0]=a=>R(s)?s.value=a:null),options:["基本資訊","商品圖片","詳細成分"],block:""},null,8,["modelValue"]),t[15]||(t[15]=u("br",null,null,-1)),l(_e,{model:e(o),ref_key:"formRef",ref:c,"label-width":"120px","label-position":"left"},{default:i(()=>[e(s)==="基本資訊"?(r(),b("div",Le,[l(E,{label:"產品名稱",required:"",prop:"name"},{default:i(()=>[l(U,{modelValue:e(o).name,"onUpdate:modelValue":t[1]||(t[1]=a=>e(o).name=a),placeholder:"產品名稱（例：原味軟法）"},null,8,["modelValue"])]),_:1}),l(E,{label:"產品類別",required:"",prop:"category_id"},{default:i(()=>[l(f,{modelValue:e(o).category_id,"onUpdate:modelValue":t[2]||(t[2]=a=>e(o).category_id=a)},null,8,["modelValue"])]),_:1}),l(E,{label:"產品定價",required:"",prop:"price"},{default:i(()=>[l(U,{modelValue:e(o).price,"onUpdate:modelValue":t[3]||(t[3]=a=>e(o).price=a),modelModifiers:{number:!0},style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(E,{label:"產品簡介",prop:"description"},{default:i(()=>[l(U,{modelValue:e(o).description,"onUpdate:modelValue":t[4]||(t[4]=a=>e(o).description=a),type:"textarea",rows:3,placeholder:"產品簡短介紹"},null,8,["modelValue"])]),_:1}),l(E,{label:"成分表",prop:"ingredients"},{default:i(()=>[l(U,{modelValue:e(o).ingredients,"onUpdate:modelValue":t[5]||(t[5]=a=>e(o).ingredients=a),type:"textarea",rows:3,placeholder:"例如：高筋麵粉、牛奶、酵母、鹽、糖"},null,8,["modelValue"])]),_:1}),l(E,{label:"狀態",required:"",prop:"is_active"},{default:i(()=>[l(N,{modelValue:e(o).is_active,"onUpdate:modelValue":t[6]||(t[6]=a=>e(o).is_active=a),placeholder:"選擇產品狀態"},null,8,["modelValue"])]),_:1})])):B("",!0),e(s)==="詳細成分"?(r(),b("div",ze,[u("div",Ne,[t[13]||(t[13]=u("small",{class:"hint"},"輸入成分與份量，可協助統計訂單所需原料。非必填欄位。",-1)),l(me,{data:e(o).ingredient_details,border:"",size:"small"},{default:i(()=>[l($,{label:"名稱",align:"center"},{default:i(({row:a})=>[l(U,{modelValue:a.name,"onUpdate:modelValue":D=>a.name=D,placeholder:"成分名稱"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l($,{label:"份量(公克)",width:"110",align:"center"},{default:i(({row:a})=>[l(U,{inputmode:"numeric",modelValue:a.grams,"onUpdate:modelValue":D=>a.grams=D,placeholder:"份量(公克)"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l($,{label:"顯示",width:"60",align:"center"},{default:i(({row:a})=>[l(Q,{size:"small",modelValue:a.is_visible,"onUpdate:modelValue":D=>a.is_visible=D},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l($,{label:"",width:"50",align:"center"},{default:i(({$index:a})=>[l(ce,{class:"delete-btn",onClick:D=>m(a)},{default:i(()=>[l(re)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(q,{type:"primary",plain:"",size:"small",onClick:t[7]||(t[7]=a=>e(o).ingredient_details.push({name:"",grams:"",is_visible:!0}))},{default:i(()=>[...t[12]||(t[12]=[M(" 新增 ",-1)])]),_:1})])])):B("",!0),e(s)==="商品圖片"?(r(),b("div",je,[l(pe,{modelValue:e(o).imageUrls,"onUpdate:modelValue":t[8]||(t[8]=a=>e(o).imageUrls=a),disabled:!1,onUpload:t[9]||(t[9]=a=>{e(o).imageUrls=a})},null,8,["modelValue"])])):B("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},Te=T(Re,[["__scopeId","data-v-125474d9"]]),qe={class:"page"},Oe={class:"toolbar"},Ae={class:"columns-2"},Ge=["src","alt"],He={key:1,class:"overlay"},Je={class:"category"},Ke={class:"info"},Qe={class:"title"},We={class:"text-ellipsis-2"},Xe={class:"description text-ellipsis-2"},Ye={class:"price"},Ze={class:"new-product flex justify-end"},el={__name:"products",setup(C){const x=y(),V=y(),n=y(null),s=y(!1),d={label:"name",value:"id"};j({page:null,limit:null,keyword:"",category_id:null});const h=y([{name:"全部",id:null}]),c=y([]),o=ne(()=>n.value===null?c.value:c.value.filter(g=>g.category_id===n.value)),_=async()=>{s.value=!0;try{const g=await I.List();h.value=[{name:"全部",id:null},...g.data.data]}catch(g){console.log("catch",g)}finally{s.value=!1}},w=async()=>{s.value=!0;try{const g=await G.List();console.log("products",g),c.value=g.data.data}catch(g){console.log("catch",g)}finally{s.value=!1}};return de(()=>{_(),w()}),(g,v)=>{const k=xe,m=ue,p=H,t=J("MoreFilled"),F=K,U=Z,E=ee;return r(),b("div",qe,[l(k,{ref_key:"editCategory",ref:x},null,512),l(Te,{ref_key:"editProduct",ref:V,onUpdate:w},null,512),u("div",Oe,[Y(l(m,{modelValue:e(n),"onUpdate:modelValue":v[0]||(v[0]=f=>R(n)?n.value=f:null),options:e(h),props:d},null,8,["modelValue","options"]),[[E,e(s)]]),l(p,{icon:"setting",text:"",onClick:v[1]||(v[1]=f=>e(x).open())})]),u("div",Ae,[(r(!0),b(L,null,z(e(o),f=>(r(),b("div",{class:"card",key:f.id},[u("div",{class:A(["thumb",{disabled:!f.is_active}])},[f.image_url?(r(),b("img",{key:0,src:f.image_url,alt:f.name},null,8,Ge)):B("",!0),f.is_active?B("",!0):(r(),b("div",He,"下架")),u("div",Je,P(f.category_name),1)],2),u("div",Ke,[u("div",Qe,[u("span",We,P(f.name),1),l(F,{onClick:N=>e(V).open(f)},{default:i(()=>[l(t)]),_:1},8,["onClick"])]),u("p",Xe,P(f.description),1),u("span",Ye,"$"+P(f.price),1)])]))),128))]),e(o).length===0?(r(),S(U,{key:0,description:"沒有符合條件的產品"})):B("",!0),u("div",Ze,[l(p,{type:"primary",circle:"",icon:"plus",size:"large",plain:"",onClick:v[2]||(v[2]=f=>e(V)?.open())})])])}}},sl=T(el,[["__scopeId","data-v-979c4376"]]);export{sl as default};

import{_ as oe,c,o as n,$ as ne,b as e,F as R,y as I,q as ee,t as h,v as N,a0 as O,r as g,a as ce,I as ie,l as se,n as P,A as Ye,g as a,d,w as b,J as re,f as ue,B as ge,E as De,L as ke,x as H,K as Me,V as $e,j as Ce,C as Se,W as Le,H as we,k as Ee,m as M,M as Ve,h as te,R as de}from"./index-DLQBT_Le.js";/* empty css                *//* empty css                     */import{s as _e,_ as Be}from"./SelectProduct-CVYdWS4e.js";/* empty css                          *//* empty css               */import"./products-yinm2DdL.js";const Oe={class:"schedule-left"},xe={class:"schedule-list"},Ae=["onClick"],Ne={class:"date-section"},Pe={class:"date-value"},Re={key:0,class:"mini-stats"},Ie={key:1,class:"mini-stats"},je={key:0,class:"stat-badge ordered"},Fe={key:1,class:"stat-badge completed"},Te={class:"stat-badge highlight"},Ue={key:2,class:"no-orders-tag"},ze={__name:"ScheduleCalendar",props:{scheduleList:{type:Array,required:!0},selectedDate:{type:String,default:null},isLoading:{type:Boolean,default:!1}},emits:["select"],setup(u,{emit:r}){const i=r,f=$=>{i("select",$)};return($,_)=>(n(),c("div",Oe,[_[1]||(_[1]=ne('<div class="schedule-week-header" data-v-33a38b5b><div class="week-day" data-v-33a38b5b>日</div><div class="week-day" data-v-33a38b5b>一</div><div class="week-day" data-v-33a38b5b>二</div><div class="week-day" data-v-33a38b5b>三</div><div class="week-day" data-v-33a38b5b>四</div><div class="week-day" data-v-33a38b5b>五</div><div class="week-day" data-v-33a38b5b>六</div></div>',1)),e("div",xe,[(n(!0),c(R,null,I(u.scheduleList,s=>(n(),c("div",{key:s.date,class:ee(["schedule-item",{"item-selected":u.selectedDate===s.date,"not-current-month":!s.isCurrentMonth}]),onClick:Y=>f(s.date)},[e("div",{class:ee(["schedule-header-row",{"no-orders":!s.hasSchedule}])},[e("div",Ne,[e("div",{class:ee(["date-box",{saturday:s.dateObj.day()===6,sunday:s.dateObj.day()===0}])},[e("div",Pe,h(s.dateObj.format("DD")),1)],2)]),u.isLoading&&!s.hasSchedule?(n(),c("div",Re,[..._[0]||(_[0]=[e("span",{class:"stat-badge muted"},"載入中",-1)])])):s.hasSchedule?(n(),c("div",Ie,[s.orderCount>0?(n(),c("span",je," 訂 "+h(s.orderCount),1)):N("",!0),s.itemCount>0?(n(),c("span",Fe," 品 "+h(s.itemCount),1)):N("",!0),e("span",Te,h(s.statusLabel),1)])):(n(),c("div",Ue,"未開單"))],2)],10,Ae))),128))])]))}},Ge=oe(ze,[["__scopeId","data-v-33a38b5b"]]),ae={Create:u=>O.post("/schedules",u),List:u=>O.post("/schedules/list",u),GetByDate:u=>O.get(`/schedules/${u}`),GetByMonth:u=>O.get(`/schedules/month/${u}`),Update:(u,r)=>O.put(`/schedules/${u}`,r),Delete:u=>O.delete(`/schedules/${u}`)},He={class:"schedule-editor"},We={class:"editor-header"},qe={class:"editor-title"},Ke={class:"editor-body"},Je={class:"editor-section"},Qe={class:"field-row"},Xe={class:"field-value"},Ze={class:"field-row"},et={class:"editor-section"},tt={class:"section-content"},st={class:"field-row add-row"},at={key:0,class:"empty-products"},ot={key:1,class:"product-list"},lt={class:"product-item"},dt={class:"product-info"},nt={class:"product-name"},ct={class:"product-limit"},it={__name:"ScheduleEditor",props:{dateLabel:{type:String,default:""}},emits:["close","save"],setup(u,{emit:r}){const i=_e,f=u,$=r,_=g(!1),s=ce({schedule_date:f.dateLabel,status:"DRAFT",order_start_at:null,order_end_at:null,items:[]});g([]);const Y=g(""),L=g(null);ie(()=>f.dateLabel,m=>{console.log("date change:",m)},{immediate:!0});const W=se(()=>s.items.map(m=>m.product_id)),q=()=>{if(!L.value)return;const m=L.value.getProductById(Y.value);if(!m)return;if(s.items.some(A=>A.product_id===m.id)){Ee.warning("此產品已在列表中"),Y.value="";return}s.items.push({product_id:m.id,name:m.name,sales_limit:0}),Y.value=""},j=m=>{s.items=s.items.filter(v=>v.product_id!==m)},x=()=>{$("close")},F=async()=>{_.value=!0;try{await ae.Create(s),we({title:"成功",message:"排程已儲存",type:"success"}),x()}catch(m){console.log("catch:",m)}finally{_.value=!1}},K=se(()=>{if(!f.dateLabel)return"";const m=f.dateLabel.split("/");return m.length===3?`${m[1]}/${m[2]}`:f.dateLabel});return(m,v)=>{const A=P("Back"),T=re,E=ue,J=P("Check"),V=De,U=Me,Q=ke,B=$e,C=Ce,X=Be,l=Le,t=ge;return n(),c("div",He,[e("div",We,[e("div",qe,"編輯"+h(a(K))+"的排程",1),e("div",null,[d(E,{class:"editor-back",circle:"",onClick:x},{default:b(()=>[d(T,null,{default:b(()=>[d(A)]),_:1})]),_:1}),d(E,{class:"editor-save",type:"primary",circle:"",loading:a(_),onClick:F},{default:b(()=>[d(T,null,{default:b(()=>[d(J)]),_:1})]),_:1},8,["loading"])])]),Ye((n(),c("div",Ke,[e("div",Je,[v[4]||(v[4]=e("div",{class:"section-title"},"排程資訊",-1)),d(C,{model:a(s),ref:"formRef",class:"schedule-form","label-position":"top"},{default:b(()=>[e("div",Qe,[d(V,{label:"日期",class:"field"},{default:b(()=>[e("div",Xe,h(u.dateLabel||"-"),1)]),_:1}),d(V,{label:"開單狀態",class:"field",prop:"status"},{default:b(()=>[d(Q,{modelValue:a(s).status,"onUpdate:modelValue":v[0]||(v[0]=o=>a(s).status=o),placeholder:"選擇狀態"},{default:b(()=>[(n(!0),c(R,null,I(a(i),o=>(n(),H(U,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),e("div",Ze,[d(V,{label:"開單開始時間",class:"field",prop:"order_start_at"},{default:b(()=>[d(B,{modelValue:a(s).order_start_at,"onUpdate:modelValue":v[1]||(v[1]=o=>a(s).order_start_at=o),type:"datetime",placeholder:"開始時間","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),d(V,{label:"開單截止時間",class:"field",prop:"order_end_at"},{default:b(()=>[d(B,{modelValue:a(s).order_end_at,"onUpdate:modelValue":v[2]||(v[2]=o=>a(s).order_end_at=o),type:"datetime",placeholder:"截止時間","value-format":"YYYY-MM-DD HH:mm:ss","default-time":new Date(2e3,1,1,12,0,0)},null,8,["modelValue","default-time"])]),_:1})])]),_:1},8,["model"])]),e("div",et,[v[6]||(v[6]=e("div",{class:"section-title"},"今日出爐產品",-1)),e("div",tt,[e("div",st,[d(X,{ref_key:"selectProductRef",ref:L,modelValue:a(Y),"onUpdate:modelValue":v[3]||(v[3]=o=>Se(Y)?Y.value=o:null),class:"product-select","exclude-ids":a(W)},null,8,["modelValue","exclude-ids"]),d(E,{type:"primary",icon:"plus",circle:"",disabled:!a(Y),onClick:q},null,8,["disabled"])]),a(s).items.length===0?(n(),c("div",at," 尚未新增產品 ")):(n(),c("div",ot,[(n(!0),c(R,null,I(a(s).items,o=>(n(),c("div",{key:o.id,class:"product-wrapper"},[e("div",lt,[e("div",dt,[e("div",nt,h(o.name),1)]),e("div",ct,[v[5]||(v[5]=e("div",{class:"field-label"},"可售上限",-1)),d(l,{modelValue:o.sales_limit,"onUpdate:modelValue":D=>o.sales_limit=D,min:0,max:999,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])]),d(E,{type:"danger",plain:"",icon:"delete",size:"small",onClick:D=>j(o.product_id)},null,8,["onClick"])]))),128))]))])])])),[[t,a(_)]])])}}},rt=oe(it,[["__scopeId","data-v-2386c6a7"]]),ut={class:"schedule-container"},_t={class:"schedule-header"},mt={class:"header-top"},vt={class:"month-navigation"},pt={class:"month-label"},ht={class:"schedule-main"},ft={key:1,class:"schedule-right"},yt={class:"detail-header"},bt={class:"detail-header-left"},Yt={class:"detail-actions"},gt={key:0,class:"detail-loading"},Dt={key:1,class:"detail-content"},kt={key:0,class:"products-section"},Mt={class:"section-title"},$t={class:"count"},Ct={class:"products-grid"},St={class:"product-info"},Lt={class:"product-name"},wt={class:"product-category"},Et={class:"product-footer"},Vt={class:"product-price"},Bt={class:"orders-section"},Ot={class:"section-title"},xt={class:"count"},At={class:"orders-list"},Nt={class:"order-id"},Pt={key:1,class:"empty-orders"},Rt={__name:"schedule",setup(u){const r=g(M()),i=g(null),f=g([]),$=g({}),_=ce({schedule_date:"",status:"DRAFT",order_start_at:null,order_end_at:null,items:[],orders:[]}),s=g(!1),Y=g(!1),L=g(!1),W=_e.reduce((l,t)=>(l[t.value]=t.label,l),{}),q=l=>{if(!l)return[];const t=M(l).format("YYYY-MM-DD");return t?[t]:[]},j=()=>{const l=[],t=r.value.startOf("month"),o=r.value.endOf("month"),D=t.day(),S=t.subtract(D,"day"),y=6-o.day(),z=o.add(y,"day");let k=S;for(;k.isBefore(z)||k.isSame(z);){const p=k.format("YYYY-MM-DD"),me=k.format("YYYY-MM"),ve=r.value.format("YYYY-MM"),pe=me===ve,G=$.value[p]||null,le=G?.order_count??0,he=G?.item_count??0,Z=G?.status||"DRAFT",fe=W[Z]||Z,ye=!!G,be=le>0;l.push({date:p,dateObj:k.clone(),orderCount:le,itemCount:he,status:Z,statusLabel:fe,hasSchedule:ye,hasOrders:be,isCurrentMonth:pe}),k=k.add(1,"day")}return l},x=()=>{f.value=j(),F()},F=()=>{f.value=j();const l=i.value;if((l?f.value.find(y=>y.date===l):null)?.isCurrentMonth){i.value=l;return}const o=M().format("YYYY-MM-DD");if(f.value.find(y=>y.date===o&&y.isCurrentMonth)){i.value=o;return}const S=f.value.find(y=>y.hasSchedule&&y.isCurrentMonth),w=f.value.find(y=>y.isCurrentMonth);i.value=S?.date||w?.date||null},K=()=>{F()},m=()=>{r.value=r.value.subtract(1,"month"),C()},v=()=>{r.value=r.value.add(1,"month"),C()},A=()=>{r.value=M(),i.value=null,C()},T=()=>{if(!i.value){i.value=M().format("YYYY-MM-DD");return}const t=M(i.value).subtract(1,"day");t.format("YYYY-MM")!==r.value.format("YYYY-MM")&&(r.value=t,C()),i.value=t.format("YYYY-MM-DD")},E=()=>{if(!i.value){i.value=M().format("YYYY-MM-DD");return}const t=M(i.value).add(1,"day");t.format("YYYY-MM")!==r.value.format("YYYY-MM")&&(r.value=t,C()),i.value=t.format("YYYY-MM-DD")},J=se(()=>r.value.format("YYYY 年 M 月")),V=l=>({ordered:"已下單",completed:"已完成",cancelled:"已取消"})[l]||l,U=l=>({ordered:"#3b82f6",completed:"#10b981",cancelled:"#ef4444"})[l]||"#6b7280",Q=()=>{s.value=!0},B=()=>{s.value=!1},C=async()=>{const l=r.value.format("YYYY-MM");Y.value=!0,$.value={},x();try{const t=await ae.GetByMonth(l),o=Array.isArray(t?.data.data)?t.data.data:[];console.log("Schedules.GetByMonth:",l,o),$.value=o.reduce((D,S)=>(q(S.schedule_date).forEach(y=>{D[y]=S}),D),{}),K()}catch{}finally{Y.value=!1}},X=async l=>{if(l){L.value=!0;try{const t=await ae.GetByDate(l);if(console.log("Schedules.GetByDate:",l,t),t.data===null){Object.assign(_,{schedule_date:l,status:"DRAFT",order_start_at:null,order_end_at:null,items:[],orders:[]});return}Object.assign(_,t.data)}catch{}finally{L.value=!1}}};return ie(()=>i.value,l=>{X(l)}),Ve(()=>{x(),C()}),(l,t)=>{const o=ue,D=rt,S=P("Close"),w=re,y=P("More"),z=P("Document"),k=Ge;return n(),c("div",ut,[e("div",_t,[e("div",mt,[t[3]||(t[3]=e("div",null,[e("h2",null,"接單排程"),e("p",{class:"subtitle"},"管理每日接單狀況，快速查看訂單資訊")],-1)),d(o,{type:"primary",icon:"Back",onClick:A},{default:b(()=>[...t[2]||(t[2]=[te(" 回到今天 ",-1)])]),_:1})]),e("div",vt,[d(o,{icon:"ArrowLeft",circle:"",onClick:m}),e("span",pt,h(a(J)),1),d(o,{icon:"ArrowRight",circle:"",onClick:v})])]),e("div",ht,[a(s)?(n(),H(D,{key:0,"date-label":a(i),onClose:B,onSave:B},null,8,["date-label"])):a(i)?(n(),c("div",ft,[e("div",yt,[e("div",bt,[d(o,{class:"day-nav-btn",icon:"ArrowLeft",circle:"",size:"small",onClick:T}),e("div",null,[e("h3",null,h(a(M)(a(i)).format("YYYY 年 M 月 DD 日 (ddd)")),1),t[4]||(t[4]=e("p",{class:"detail-stats"},[te(" 共 N 筆訂單 | "),e("span",{class:"stat-ordered"},"↓ N"),e("span",{class:"stat-completed"},"✓ N"),e("span",{class:"stat-cancelled"},"✕ N"),te(" | 營收 $??? ")],-1))]),d(o,{class:"day-nav-btn",icon:"ArrowRight",circle:"",size:"small",onClick:E})]),e("div",Yt,[d(o,{class:"detail-more",circle:"",onClick:t[0]||(t[0]=p=>a(s)?B():Q())},{default:b(()=>[a(s)?(n(),H(w,{key:0},{default:b(()=>[d(S)]),_:1})):(n(),H(w,{key:1},{default:b(()=>[d(y)]),_:1}))]),_:1})])]),a(L)?(n(),c("div",gt," 資料載入中... ")):(n(),c("div",Dt,[a(_).items.length>0?(n(),c("div",kt,[e("div",Mt,[t[5]||(t[5]=e("span",null,"今日出爐",-1)),e("span",$t,h(a(_).items.length)+" 項商品",1)]),e("div",Ct,[(n(!0),c(R,null,I(a(_).items,p=>(n(),c("div",{key:p.id,class:"product-card"},[e("div",St,[e("h4",Lt,h(p.product_name),1),e("p",wt,h(p.category),1),e("div",Et,[e("span",Vt,"$"+h(p.unit_price),1)])])]))),128))])])):N("",!0),e("div",Bt,[e("div",Ot,[t[6]||(t[6]=e("span",null,"訂單清單",-1)),e("span",xt,h(a(_).orders.length)+" 筆",1)]),e("div",At,[(n(!0),c(R,null,I(a(_).orders,p=>(n(),c("div",{key:p.id,class:"order-row",style:de({borderLeftColor:U(p.status)})},[e("div",Nt,h(p.id),1),t[7]||(t[7]=ne('<div class="order-customer" data-v-8877d4ad><span class="name" data-v-8877d4ad>Customer</span></div><div class="order-time" data-v-8877d4ad>--:--</div><div class="order-items" data-v-8877d4ad>0 項</div><div class="order-amount" data-v-8877d4ad>$00</div>',4)),e("div",{class:"order-status",style:de({background:U(p.status)})},h(V(p.status)),5)],4))),128))])]),a(_).orders.length===0&&a(_).items.length===0?(n(),c("div",Pt,[d(w,null,{default:b(()=>[d(z)]),_:1}),t[8]||(t[8]=e("p",null,"該日期暫無訂單及商品",-1))])):N("",!0)]))])):N("",!0),d(k,{"schedule-list":a(f),"selected-date":a(i),"is-loading":a(Y),onSelect:t[1]||(t[1]=p=>i.value=p)},null,8,["schedule-list","selected-date","is-loading"])])])}}},Ht=oe(Rt,[["__scopeId","data-v-8877d4ad"]]);export{Ht as default};

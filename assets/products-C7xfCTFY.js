import{x as P,_ as T,r as V,a as q,y as B,o as c,w as i,b as u,z as Z,c as h,g as e,F as z,A as N,d as l,t as S,f as J,B as ee,C as le,j as te,E as oe,e as ae,h as F,D as R,G as ne,H as fe,I as A,J as ye,l as se,n as K,v as D,K as Q,q as G,k as X,L as de,M as ie,N as re,O as ue,P as Ve,Q as be,R as he,S as Y}from"./index-DHZAEWta.js";/* empty css               *//* empty css            */const H={List:a=>P.post("/products/list",a),GetById:a=>P.get(`/products/${a}`),Create:a=>P.post("/products",a),Update:(a,k)=>P.put(`/products/${a}`,k),Delete:a=>P.delete(`/products/${a}`)},M={List:a=>P.post("/product-categories/list",a),GetById:a=>P.get(`/product-categories/${a}`),Create:a=>P.post("/product-categories",a),Update:(a,k)=>P.put(`/product-categories/${a}`,k),Delete:a=>P.delete(`/product-categories/${a}`)},Ce={class:"layout"},$e={class:"list"},ke={key:0,class:"chips"},Ue={class:"chip__title"},we={class:"form"},xe={__name:"EditCategory",emits:["save"],setup(a,{expose:k,emit:b}){const s=V(!1),d=V(!1),r=V([]);V([]);const C=q({page:null,limit:null,keyword:""}),p=q({name:""}),o=()=>{d.value=!0},g=()=>{d.value=!1},w=async()=>{s.value=!0;try{const $=await M.Create(p);A({title:"成功",message:"已新增種類",type:"success"}),p.name="",await f()}catch($){console.log("catch",$)}finally{s.value=!1}},v=$=>{fe.confirm("確定要刪除這個種類嗎？","警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(async()=>{s.value=!0;try{await M.Delete($),A({title:"成功",message:"已刪除種類",type:"success"}),await f()}catch(m){console.log("catch",m)}finally{s.value=!1}}).catch(()=>{})};k({open:o,close:g});const f=async()=>{s.value=!0;try{const $=await M.List(C);console.log("res",$),r.value=$.data.data}catch($){console.log("fetch categories error",$)}finally{s.value=!1}};return($,m)=>{const _=J,t=ee,L=ae,x=oe,E=te,y=ne,j=le;return c(),B(y,{modelValue:e(d),"onUpdate:modelValue":m[1]||(m[1]=U=>R(d)?d.value=U:null),title:"編輯商品種類",width:"800px","append-to-body":"","destroy-on-close":"","close-on-click-modal":!1,onOpened:f},{footer:i(()=>[l(_,{onClick:g},{default:i(()=>[...m[5]||(m[5]=[F("返回",-1)])]),_:1})]),default:i(()=>[u("div",Ce,[Z((c(),h("section",$e,[m[2]||(m[2]=u("header",null,[u("h3",null,"現有種類"),u("small",null,"若種類被移除，原已存在的商品將被歸類為「未分類」")],-1)),e(r).length?(c(),h("div",ke,[(c(!0),h(z,null,N(e(r),U=>(c(),h("div",{class:"chip",key:U.id},[u("div",Ue,S(U.name),1),l(_,{size:"small",icon:"Minus",circle:"",plain:"",onClick:W=>v(U.id)},null,8,["onClick"])]))),128))])):(c(),B(t,{key:1,description:"目前沒有種類"}))])),[[j,e(s)]]),u("section",we,[m[4]||(m[4]=u("header",null,[u("h3",null,"新增種類")],-1)),l(E,{model:e(p),"label-width":"60px","label-position":"top"},{default:i(()=>[l(x,{label:"名稱",prop:"name"},{default:i(()=>[l(L,{modelValue:e(p).name,"onUpdate:modelValue":m[0]||(m[0]=U=>e(p).name=U),placeholder:"輸入種類名稱"},null,8,["modelValue"])]),_:1}),l(x,null,{default:i(()=>[l(_,{type:"primary",onClick:w},{default:i(()=>[...m[3]||(m[3]=[F("新增",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1},8,["modelValue"])}}},Ee=T(xe,[["__scopeId","data-v-1bea777f"]]),Pe={class:"images-uploader"},Se=["src","alt"],Be={class:"upload-text"},De={class:"hint"},Ie={__name:"UploadPhotos",props:{modelValue:{type:Array,default:()=>[]},disabled:Boolean,max:{type:Number,default:4}},emits:["upload","delete","update:modelValue"],setup(a,{emit:k}){const b=a,s=k,d=V(!1),r=V([...b.modelValue]),C=async g=>{const w=Array.from(g.target.files),v=r.value.length,f=Math.min(w.length,b.max-v);if(f===0){X.warning(`最多只能上傳 ${b.max} 張圖片`);return}w.slice(0,f).forEach(m=>{const _=URL.createObjectURL(m);r.value.push(_),s("upload",_)}),s("update:modelValue",r.value),g.target.value="",f<w.length&&X.info(`已達上傳上限，共上傳 ${f} 張`)},p=g=>{r.value.splice(g,1),s("delete",g),s("update:modelValue",r.value)};ye(()=>b.modelValue,g=>{r.value=[...g]},{deep:!0});const o=se(()=>r.value.length<b.max);return(g,w)=>{const v=K("Delete"),f=Q;return c(),h("div",Pe,[u("div",{class:G(["gallery",{"has-images":r.value.length>0}])},[(c(!0),h(z,null,N(r.value,($,m)=>(c(),h("div",{key:m,class:"image-item"},[u("img",{src:$,alt:`圖片 ${m+1}`},null,8,Se),l(f,{class:"delete-btn",onClick:_=>p(m)},{default:i(()=>[l(v)]),_:1},8,["onClick"])]))),128)),o.value?(c(),h("label",{key:0,for:"image-upload",class:G([{disabled:d.value||a.disabled},"upload-box"])},[u("div",Be,S(d.value?"上傳中...":"上傳圖片"),1),u("small",null,S(r.value.length)+"/"+S(a.max),1)],2)):D("",!0)],2),u("small",De,"建議尺寸 600x400，檔案小於 1MB，最多 "+S(a.max)+" 張",1),u("input",{type:"file",id:"image-upload",accept:".png,.jpg,.jpeg,.webp",multiple:"",onChange:C},null,32)])}}},Le=T(Ie,[["__scopeId","data-v-77a54f16"]]),Fe={__name:"SelectProductStatus",props:{modelValue:Boolean,placeholder:{type:String,default:"請選擇"}},emits:["update:modelValue"],setup(a,{emit:k}){const b=V([{value:!0,label:"啟用"},{value:!1,label:"下架"}]);return(s,d)=>{const r=de,C=ie;return c(),B(C,{modelValue:a.modelValue,onClear:d[0]||(d[0]=p=>s.$emit("update:modelValue",null)),"onUpdate:modelValue":d[1]||(d[1]=p=>s.$emit("update:modelValue",p)),placeholder:a.placeholder},{default:i(()=>[(c(!0),h(z,null,N(e(b),p=>(c(),B(r,{key:p.id,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])}}},Me={__name:"SelectCategory",props:{modelValue:String,placeholder:{type:String,default:"請選擇種類"}},emits:["update:modelValue"],setup(a,{emit:k}){const b=V(!1),s=V([]),d=async()=>{b.value=!0;try{const r=await M.List();console.log("res",r),s.value=r.data.data}catch(r){console.log("fetch categories error",r)}finally{b.value=!1}};return re(()=>{d()}),(r,C)=>{const p=de,o=ie;return c(),B(o,{modelValue:a.modelValue,onClear:C[0]||(C[0]=g=>r.$emit("update:modelValue",null)),"onUpdate:modelValue":C[1]||(C[1]=g=>r.$emit("update:modelValue",g)),placeholder:a.placeholder,loading:e(b)},{default:i(()=>[(c(!0),h(z,null,N(e(s),g=>(c(),B(p,{key:g.id,label:g.name,value:g.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])}}},ze={key:0},Ne={key:1},je={class:"ing-table"},qe={key:2},Re={__name:"EditProduct",emits:["update"],setup(a,{expose:k,emit:b}){const s=V(!1),d=V("基本資訊"),r=b,C=V(!1),p=V(null),o=q({id:null,name:"",category_id:"",price:0,description:"",ingredients:"",ingredient_details:[],imageUrls:[],is_active:!0}),g=()=>{Y(()=>{p.value?.resetFields()})},w=(_={})=>{d.value="基本資訊",s.value=!0,_?.id?Y(()=>{Object.assign(o,_)}):(o.id=null,g())},v=()=>{s.value=!1},f=async _=>{_.validate(t=>{if(t)$();else return})},$=async()=>{C.value=!0;try{let _;o.id?_=await H.Update(o.id,o):_=await H.Create(o),console.log("save product res",_),A({title:"成功",message:`商品已${o.id?"更新":"新增"}成功`,type:"success"}),v(),r("update")}catch(_){console.log("save product error",_)}finally{C.value=!1}},m=_=>{o.ingredient_details.splice(_,1)};return k({open:w,close:v}),(_,t)=>{const L=ue,x=ae,E=oe,y=Me,j=Fe,U=be,W=he,ce=K("Delete"),pe=Q,me=Ve,O=J,_e=Le,ge=te,ve=ne;return c(),B(ve,{modelValue:e(s),"onUpdate:modelValue":t[11]||(t[11]=n=>R(s)?s.value=n:null),title:e(o).id?"編輯商品":"新增商品",width:"800px","append-to-body":""},{footer:i(()=>[l(O,{onClick:v},{default:i(()=>[...t[14]||(t[14]=[F("取消",-1)])]),_:1}),l(O,{type:"primary",onClick:t[10]||(t[10]=n=>f(e(p))),loading:e(C)},{default:i(()=>[F(S(e(o).id?"儲存":"新增"),1)]),_:1},8,["loading"])]),default:i(()=>[l(L,{modelValue:e(d),"onUpdate:modelValue":t[0]||(t[0]=n=>R(d)?d.value=n:null),options:["基本資訊","商品圖片","詳細成分"],block:""},null,8,["modelValue"]),t[15]||(t[15]=u("br",null,null,-1)),l(ge,{model:e(o),ref_key:"formRef",ref:p,"label-width":"120px","label-position":"left"},{default:i(()=>[e(d)==="基本資訊"?(c(),h("div",ze,[l(E,{label:"產品名稱",required:"",prop:"name"},{default:i(()=>[l(x,{modelValue:e(o).name,"onUpdate:modelValue":t[1]||(t[1]=n=>e(o).name=n),placeholder:"產品名稱（例：原味軟法）"},null,8,["modelValue"])]),_:1}),l(E,{label:"產品類別",required:"",prop:"category_id"},{default:i(()=>[l(y,{modelValue:e(o).category_id,"onUpdate:modelValue":t[2]||(t[2]=n=>e(o).category_id=n)},null,8,["modelValue"])]),_:1}),l(E,{label:"產品定價",required:"",prop:"price"},{default:i(()=>[l(x,{modelValue:e(o).price,"onUpdate:modelValue":t[3]||(t[3]=n=>e(o).price=n),modelModifiers:{number:!0},style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(E,{label:"產品簡介",prop:"description"},{default:i(()=>[l(x,{modelValue:e(o).description,"onUpdate:modelValue":t[4]||(t[4]=n=>e(o).description=n),type:"textarea",rows:3,placeholder:"產品簡短介紹"},null,8,["modelValue"])]),_:1}),l(E,{label:"成分表",prop:"ingredients"},{default:i(()=>[l(x,{modelValue:e(o).ingredients,"onUpdate:modelValue":t[5]||(t[5]=n=>e(o).ingredients=n),type:"textarea",rows:3,placeholder:"例如：高筋麵粉、牛奶、酵母、鹽、糖"},null,8,["modelValue"])]),_:1}),l(E,{label:"狀態",required:"",prop:"is_active"},{default:i(()=>[l(j,{modelValue:e(o).is_active,"onUpdate:modelValue":t[6]||(t[6]=n=>e(o).is_active=n),placeholder:"選擇產品狀態"},null,8,["modelValue"])]),_:1})])):D("",!0),e(d)==="詳細成分"?(c(),h("div",Ne,[u("div",je,[t[13]||(t[13]=u("small",{class:"hint"},"輸入成分與份量，可協助統計訂單所需原料。非必填欄位。",-1)),l(me,{data:e(o).ingredient_details,border:"",size:"small"},{default:i(()=>[l(U,{label:"名稱",align:"center"},{default:i(({row:n})=>[l(x,{modelValue:n.name,"onUpdate:modelValue":I=>n.name=I,placeholder:"成分名稱"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(U,{label:"份量(公克)",width:"110",align:"center"},{default:i(({row:n})=>[l(x,{inputmode:"numeric",modelValue:n.grams,"onUpdate:modelValue":I=>n.grams=I,placeholder:"份量(公克)"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(U,{label:"顯示",width:"60",align:"center"},{default:i(({row:n})=>[l(W,{size:"small",modelValue:n.is_visible,"onUpdate:modelValue":I=>n.is_visible=I},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(U,{label:"",width:"50",align:"center"},{default:i(({$index:n})=>[l(pe,{class:"delete-btn",onClick:I=>m(n)},{default:i(()=>[l(ce)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(O,{type:"primary",plain:"",size:"small",onClick:t[7]||(t[7]=n=>e(o).ingredient_details.push({name:"",grams:"",is_visible:!0}))},{default:i(()=>[...t[12]||(t[12]=[F(" 新增 ",-1)])]),_:1})])])):D("",!0),e(d)==="商品圖片"?(c(),h("div",qe,[l(_e,{modelValue:e(o).imageUrls,"onUpdate:modelValue":t[8]||(t[8]=n=>e(o).imageUrls=n),disabled:!1,onUpload:t[9]||(t[9]=n=>{e(o).imageUrls=n})},null,8,["modelValue"])])):D("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},Te=T(Re,[["__scopeId","data-v-125474d9"]]),Oe={class:"page"},Ae={class:"toolbar"},Ge={class:"columns-2"},He=["src","alt"],Je={key:1,class:"overlay"},Ke={class:"category"},Qe={class:"info"},We={class:"title"},Xe={class:"text-ellipsis-2"},Ye={class:"description text-ellipsis-2"},Ze={class:"price"},el={class:"new-product flex justify-end"},ll={__name:"products",setup(a){const k=V(),b=V(),s=V(null),d=V(!1),r={label:"name",value:"id"};q({page:null,limit:null,keyword:"",category_id:null});const C=V([{name:"全部",id:null}]),p=V([]),o=se(()=>s.value===null?p.value:p.value.filter(v=>v.category_id===s.value)),g=async()=>{d.value=!0;try{const v=await M.List();C.value=[{name:"全部",id:null},...v.data.data]}catch(v){console.log("catch",v)}finally{d.value=!1}},w=async()=>{d.value=!0;try{const v=await H.List();console.log("products",v),p.value=v.data.data}catch(v){console.log("catch",v)}finally{d.value=!1}};return re(()=>{g(),w()}),(v,f)=>{const $=Ee,m=ue,_=J,t=K("MoreFilled"),L=Q,x=ee,E=le;return c(),h("div",Oe,[l($,{ref_key:"editCategory",ref:k},null,512),l(Te,{ref_key:"editProduct",ref:b,onUpdate:w},null,512),u("div",Ae,[Z(l(m,{modelValue:e(s),"onUpdate:modelValue":f[0]||(f[0]=y=>R(s)?s.value=y:null),options:e(C),props:r},null,8,["modelValue","options"]),[[E,e(d)]]),l(_,{icon:"setting",text:"",onClick:f[1]||(f[1]=y=>e(k).open())})]),u("div",Ge,[(c(!0),h(z,null,N(e(o),y=>(c(),h("div",{class:"card",key:y.id},[u("div",{class:G(["thumb",{disabled:!y.is_active}])},[y.image_url?(c(),h("img",{key:0,src:y.image_url,alt:y.name},null,8,He)):D("",!0),y.is_active?D("",!0):(c(),h("div",Je,"下架")),u("div",Ke,S(y.category_name),1)],2),u("div",Qe,[u("div",We,[u("span",Xe,S(y.name),1),l(L,{onClick:j=>e(b).open(y)},{default:i(()=>[l(t)]),_:1},8,["onClick"])]),u("p",Ye,S(y.description),1),u("span",Ze,"$"+S(y.price),1)])]))),128))]),e(o).length===0?(c(),B(x,{key:0,description:"沒有符合條件的產品"})):D("",!0),u("div",el,[l(_,{type:"primary",circle:"",icon:"plus",size:"large",plain:"",onClick:f[2]||(f[2]=y=>e(b)?.open())})])])}}},nl=T(ll,[["__scopeId","data-v-979c4376"]]);export{nl as default};

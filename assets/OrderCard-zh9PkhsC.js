import{_ as N,r as q,l as A,y as O,o as i,w as r,b as e,c as u,x as k,d,f as L,h as p,F as B,z as j,t as a,W as F,P as H,n as z,O as R,D as W,g as E,m as M,X,Y,v as G}from"./index-BgSJ_Wi1.js";/* empty css               */import{_ as J,o as K}from"./SelectProduct-ChkgrWk-.js";/* empty css               *//* empty css                     */const Q={class:"order-detail"},Z={class:"items-section"},ee={class:"section-header"},te={key:0,class:"items-table"},se={class:"item-name-section"},oe={class:"item-price-section"},le={class:"price"},ne={class:"item-quantity-section"},de={key:1,class:"no-items"},ie={class:"total-section"},ae={class:"total-row"},re={class:"amount"},ue={key:0,class:"add-product-section"},ce={class:"add-product-header"},me={class:"add-product-row"},ve={__name:"OrderDetail",props:{order:{type:Object,required:!0}},emits:["close","update-items"],setup(o,{expose:S,emit:P}){const f=q(!1),x=q(null),_=q(""),V=o,C=P,$=q(!1),v=q([]),D=()=>{v.value=V.order?.items?V.order.items.map(n=>({...n})):[]};V.order?.items&&D();const T=(n,s)=>{s>0&&(v.value[n].quantity=parseInt(s))},I=n=>{v.value.splice(n,1)},U=()=>{if(!_.value||!x.value)return;const n=x.value.getProductById(_.value);if(!n)return;const s=v.value.find(y=>y.id===n.id);s?s.quantity+=1:v.value.push({id:n.id,name:n.name,price:n.price,quantity:1}),_.value="",f.value=!1},l=A(()=>v.value.reduce((n,s)=>n+s.price*s.quantity,0)),t=()=>{$.value=!1,C("close")},b=()=>{C("update-items",v.value),$.value=!1,C("close")};return S({visible:$}),(n,s)=>{const y=L,g=F,h=H;return i(),O(h,{center:"",modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=c=>$.value=c),title:"訂購明細",width:"75%",onClose:t,class:"order-detail-dialog"},{footer:r(()=>[d(y,{onClick:t},{default:r(()=>[...s[13]||(s[13]=[p("取消",-1)])]),_:1}),d(y,{type:"primary",onClick:b},{default:r(()=>[...s[14]||(s[14]=[p("確認",-1)])]),_:1})]),default:r(()=>[e("div",Q,[e("div",Z,[e("div",ee,[s[5]||(s[5]=e("h3",null,"訂購項目",-1)),d(y,{type:"success",onClick:s[0]||(s[0]=c=>f.value=!0)},{default:r(()=>[...s[4]||(s[4]=[p(" 新增項目 ",-1)])]),_:1})]),v.value.length>0?(i(),u("div",te,[(i(!0),u(B,null,j(v.value,(c,m)=>(i(),u("div",{key:m,class:"item-card"},[s[8]||(s[8]=e("div",{class:"item-image-section"},null,-1)),e("div",se,a(c.name),1),e("div",oe,[s[6]||(s[6]=e("span",{class:"label"},"單價:",-1)),e("span",le,"$"+a(c.price),1)]),e("div",ne,[s[7]||(s[7]=e("span",{class:"quantity-label"},"數量:",-1)),d(g,{modelValue:c.quantity,"onUpdate:modelValue":w=>c.quantity=w,min:1,max:999,onChange:w=>T(m,w)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),d(y,{size:"small",icon:"delete",type:"danger",plain:"",onClick:w=>I(m)},null,8,["onClick"])]))),128))])):(i(),u("div",de,"沒有訂購項目"))]),e("div",ie,[e("div",ae,[s[9]||(s[9]=e("span",{class:"label"},"訂單總計：",-1)),e("span",re,"$"+a(l.value),1)])]),f.value?(i(),u("div",ue,[e("div",ce,[s[11]||(s[11]=e("h4",null,"新增產品",-1)),d(y,{text:"",onClick:s[1]||(s[1]=c=>f.value=!1)},{default:r(()=>[...s[10]||(s[10]=[p("關閉",-1)])]),_:1})]),e("div",me,[d(J,{ref_key:"selectProductRef",ref:x,modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=c=>_.value=c),class:"flex-1"},null,8,["modelValue"]),d(y,{type:"primary",disabled:!_.value,onClick:U},{default:r(()=>[...s[12]||(s[12]=[p(" 新增 ",-1)])]),_:1},8,["disabled"])])])):k("",!0)])]),_:1},8,["modelValue"])}}},pe=N(ve,[["__scopeId","data-v-4ccdb844"]]),fe={class:"order-header"},ye={class:"order-id-section"},ke={class:"order-id"},_e={class:"id-prefix"},be={class:"id-highlight"},$e={class:"order-customer"},Ce={class:"info-row"},ge={class:"info-label"},we={class:"info-value"},qe={key:0,class:"info-row"},xe={class:"info-label"},Ve={class:"info-value"},Ie={key:1,class:"info-row"},Pe={class:"info-label"},De={class:"info-value pickup-time"},ze={key:0,class:"pickup-date"},Me={key:0,class:"order-items"},Oe={class:"items-header"},Se={class:"items-list"},Te={class:"item-name"},Ue={class:"item-quantity"},he={class:"item-price"},Be={key:1,class:"order-note"},Ee={class:"note-label"},Ne={class:"note-content"},Ae={class:"order-footer"},Le={class:"footer-info"},je={key:0,class:"payment-method"},Fe={class:"order-total"},He={class:"total-amount"},Re={__name:"OrderCard",props:{order:{type:Object,required:!0},viewMode:{type:String,required:!0}},emits:["open","status-change"],setup(o,{emit:S}){const P=q(null),f=o,x=K,_=S,V=l=>({ordered:"已下單",completed:"已完成",cancelled:"已取消"})[l]||l,C=l=>x.find(b=>b.value===l)?.color||"#6b7280",$=l=>({cash:"現金",bank:"匯款",linepay:"Line Pay",card:"信用卡"})[l]||l,v=l=>M(l).isSame(M(),"day"),D=A(()=>{const l=f.order?.id||"",t=l.slice(-3);return{prefix:l.slice(0,-3),lastThree:t}}),T=()=>{_("open",f.order.id)},I=l=>{_("status-change",f.order,l)},U=l=>{f.order.items=l,f.order.totalAmount=l.reduce((t,b)=>t+b.price*b.quantity,0)};return(l,t)=>{const b=z("User"),n=W,s=z("Phone"),y=z("AlarmClock"),g=L,h=z("Document"),c=X;return i(),u(B,null,[e("div",{class:G(["order-card",{"simple-mode":o.viewMode==="simple"}]),onClick:T},[t[17]||(t[17]=e("div",{class:"order-ticket-top"},null,-1)),e("div",fe,[e("div",ye,[t[5]||(t[5]=e("div",{class:"order-label"},"訂單編號",-1)),e("div",ke,[e("span",_e,a(D.value.prefix),1),e("span",be,a(D.value.lastThree),1)])]),e("div",{class:"order-status-stamp",style:R({borderColor:C(o.order.status),color:C(o.order.status)})},[e("span",null,a(V(o.order.status)),1)],4)]),e("div",$e,[e("div",Ce,[e("div",ge,[d(n,null,{default:r(()=>[d(b)]),_:1}),t[6]||(t[6]=e("span",null,"顧客",-1))]),e("span",we,a(o.order.customerName),1)]),o.viewMode==="detailed"?(i(),u("div",qe,[e("div",xe,[d(n,null,{default:r(()=>[d(s)]),_:1}),t[7]||(t[7]=e("span",null,"電話",-1))]),e("span",Ve,a(o.order.phone),1)])):k("",!0),o.viewMode==="detailed"?(i(),u("div",Ie,[e("div",Pe,[d(n,null,{default:r(()=>[d(y)]),_:1}),t[8]||(t[8]=e("span",null,"取貨",-1))]),e("span",De,[v(o.order.pickupTime)?k("",!0):(i(),u("span",ze,a(E(M)(o.order.pickupTime).format("MM/DD")),1)),p(" "+a(E(M)(o.order.pickupTime).format("HH:mm")),1)])])):k("",!0)]),t[18]||(t[18]=e("div",{class:"order-divider"},null,-1)),o.viewMode==="detailed"?(i(),u("div",Me,[e("div",Oe,[t[10]||(t[10]=e("span",null,"訂購明細",-1)),d(g,{type:"primary",size:"small",onClick:t[0]||(t[0]=m=>P.value.visible=!0)},{default:r(()=>[...t[9]||(t[9]=[p("詳細",-1)])]),_:1})]),e("div",Se,[(i(!0),u(B,null,j(o.order.items,(m,w)=>(i(),u("div",{key:w,class:"order-item"},[e("span",Te,a(m.name),1),e("span",Ue,"× "+a(m.quantity),1),e("span",he,"$"+a(m.price*m.quantity),1)]))),128)),e("pre",null,a(o.order.items),1)])])):k("",!0),o.viewMode==="detailed"&&o.order.note?(i(),u("div",Be,[e("div",Ee,[d(n,null,{default:r(()=>[d(h)]),_:1}),t[11]||(t[11]=e("span",null,"備註",-1))]),e("div",Ne,a(o.order.note),1)])):k("",!0),e("div",Ae,[e("div",Le,[o.viewMode==="detailed"?(i(),u("div",je,[t[12]||(t[12]=e("span",{class:"label"},"付款方式",-1)),d(c,{size:"small",type:"info"},{default:r(()=>[p(a($(o.order.payment)),1)]),_:1})])):k("",!0)]),e("div",Fe,[t[13]||(t[13]=e("span",{class:"total-label"},"總計",-1)),e("span",He,"$"+a(o.order.totalAmount),1)])]),e("div",{class:"order-actions",onClick:t[4]||(t[4]=Y(()=>{},["stop"]))},[o.order.status==="ordered"?(i(),O(g,{key:0,type:"danger",plain:"",size:"small",onClick:t[1]||(t[1]=m=>I("cancelled"))},{default:r(()=>[...t[14]||(t[14]=[p(" 取消訂單 ",-1)])]),_:1})):k("",!0),o.order.status==="ordered"?(i(),O(g,{key:1,class:"complete",type:"success",size:"small",onClick:t[2]||(t[2]=m=>I("completed"))},{default:r(()=>[...t[15]||(t[15]=[p(" 完成訂單 ",-1)])]),_:1})):k("",!0),o.order.status==="completed"||o.order.status==="cancelled"?(i(),O(g,{key:2,type:"primary",plain:"",size:"small",onClick:t[3]||(t[3]=m=>I("ordered"))},{default:r(()=>[...t[16]||(t[16]=[p(" 復原為已下單 ",-1)])]),_:1})):k("",!0)]),t[19]||(t[19]=e("div",{class:"order-ticket-bottom"},null,-1))],2),d(pe,{ref_key:"orderDetail",ref:P,order:o.order,onUpdateItems:U},null,8,["order"])],64)}}},Ke=N(Re,[["__scopeId","data-v-f87fc9ce"]]);export{Ke as _};

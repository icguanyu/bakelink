import{_ as G,r as V,a as q,x as S,o as u,w as s,b as a,A as Y,c as b,g as e,F as N,y as T,d as l,t as E,f as K,z as Z,B as ee,j as le,E as te,e as oe,h as B,C as O,D as ae,G as ne,H as A,I as ye,l as se,n as Q,v as D,J as W,q as H,k as J,K as ie,L as de,M as re,N as ue,O as Ve,P as be,Q as he,R as ke,S as X}from"./index-Dl5cwTgt.js";/* empty css              *//* empty css               */import{P as L,a as R}from"./products-DWmKqage.js";/* empty css                  *//* empty css            *//* empty css               */const Ce={class:"layout"},we={class:"list"},$e={key:0,class:"chips"},Ue={class:"chip__title"},xe={class:"form"},Ee={__name:"EditCategory",emits:["save"],setup(C,{expose:U,emit:h}){const i=V(!1),d=V(!1),r=V([]);V([]);const f=q({page:null,limit:null,keyword:""}),m=q({name:""}),t=()=>{d.value=!0},g=()=>{d.value=!1},w=async()=>{i.value=!0;try{const k=await L.Create(m);A({title:"成功",message:"已新增種類",type:"success"}),m.name="",await c()}catch(k){console.log("catch",k)}finally{i.value=!1}},v=k=>{ne.confirm("確定要刪除這個種類嗎？","警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(async()=>{i.value=!0;try{await L.Delete(k),A({title:"成功",message:"已刪除種類",type:"success"}),await c()}catch(p){console.log("catch",p)}finally{i.value=!1}}).catch(()=>{})};U({open:t,close:g});const c=async()=>{i.value=!0;try{const k=await L.List(f);console.log("res",k),r.value=k.data.data}catch(k){console.log("fetch categories error",k)}finally{i.value=!1}};return(k,p)=>{const $=K,y=Z,o=oe,I=te,x=le,_=ae,z=ee;return u(),S(_,{modelValue:e(d),"onUpdate:modelValue":p[1]||(p[1]=P=>O(d)?d.value=P:null),title:"編輯商品種類",width:"800px","append-to-body":"","destroy-on-close":"","close-on-click-modal":!1,onOpened:c},{footer:s(()=>[l($,{onClick:g},{default:s(()=>[...p[5]||(p[5]=[B("返回",-1)])]),_:1})]),default:s(()=>[a("div",Ce,[Y((u(),b("section",we,[p[2]||(p[2]=a("header",null,[a("h3",null,"現有種類"),a("small",null,"若種類被移除，原已存在的商品將被歸類為「未分類」")],-1)),e(r).length?(u(),b("div",$e,[(u(!0),b(N,null,T(e(r),P=>(u(),b("div",{class:"chip",key:P.id},[a("div",Ue,E(P.name),1),l($,{size:"small",icon:"Minus",circle:"",plain:"",onClick:M=>v(P.id)},null,8,["onClick"])]))),128))])):(u(),S(y,{key:1,description:"目前沒有種類"}))])),[[z,e(i)]]),a("section",xe,[p[4]||(p[4]=a("header",null,[a("h3",null,"新增種類")],-1)),l(x,{model:e(m),"label-width":"60px","label-position":"top"},{default:s(()=>[l(I,{label:"名稱",prop:"name"},{default:s(()=>[l(o,{modelValue:e(m).name,"onUpdate:modelValue":p[0]||(p[0]=P=>e(m).name=P),placeholder:"輸入種類名稱"},null,8,["modelValue"])]),_:1}),l(I,null,{default:s(()=>[l($,{type:"primary",onClick:w},{default:s(()=>[...p[3]||(p[3]=[B("新增",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1},8,["modelValue"])}}},Pe=G(Ee,[["__scopeId","data-v-1bea777f"]]),Se={class:"images-uploader"},Be=["src","alt"],De={class:"upload-text"},Ie={class:"hint"},Fe={__name:"UploadPhotos",props:{modelValue:{type:Array,default:()=>[]},disabled:Boolean,max:{type:Number,default:4}},emits:["upload","delete","update:modelValue"],setup(C,{emit:U}){const h=C,i=U,d=V(!1),r=V([...h.modelValue]),f=async g=>{const w=Array.from(g.target.files),v=r.value.length,c=Math.min(w.length,h.max-v);if(c===0){J.warning(`最多只能上傳 ${h.max} 張圖片`);return}w.slice(0,c).forEach(p=>{const $=URL.createObjectURL(p);r.value.push($),i("upload",$)}),i("update:modelValue",r.value),g.target.value="",c<w.length&&J.info(`已達上傳上限，共上傳 ${c} 張`)},m=g=>{r.value.splice(g,1),i("delete",g),i("update:modelValue",r.value)};ye(()=>h.modelValue,g=>{r.value=[...g]},{deep:!0});const t=se(()=>r.value.length<h.max);return(g,w)=>{const v=Q("Delete"),c=W;return u(),b("div",Se,[a("div",{class:H(["gallery",{"has-images":r.value.length>0}])},[(u(!0),b(N,null,T(r.value,(k,p)=>(u(),b("div",{key:p,class:"image-item"},[a("img",{src:k,alt:`圖片 ${p+1}`},null,8,Be),l(c,{class:"delete-btn",onClick:$=>m(p)},{default:s(()=>[l(v)]),_:1},8,["onClick"])]))),128)),t.value?(u(),b("label",{key:0,for:"image-upload",class:H([{disabled:d.value||C.disabled},"upload-box"])},[a("div",De,E(d.value?"上傳中...":"上傳圖片"),1),a("small",null,E(r.value.length)+"/"+E(C.max),1)],2)):D("",!0)],2),a("small",Ie,"建議尺寸 600x400，檔案小於 1MB，最多 "+E(C.max)+" 張",1),a("input",{type:"file",id:"image-upload",accept:".png,.jpg,.jpeg,.webp",multiple:"",onChange:f},null,32)])}}},Me=G(Fe,[["__scopeId","data-v-77a54f16"]]),Le={__name:"SelectProductStatus",props:{modelValue:Boolean,placeholder:{type:String,default:"請選擇"}},emits:["update:modelValue"],setup(C,{emit:U}){const h=V([{value:!0,label:"啟用"},{value:!1,label:"下架"}]);return(i,d)=>{const r=ie,f=de;return u(),S(f,{modelValue:C.modelValue,onClear:d[0]||(d[0]=m=>i.$emit("update:modelValue",null)),"onUpdate:modelValue":d[1]||(d[1]=m=>i.$emit("update:modelValue",m)),placeholder:C.placeholder},{default:s(()=>[(u(!0),b(N,null,T(e(h),m=>(u(),S(r,{key:m.id,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])}}},Ne={__name:"SelectCategory",props:{modelValue:String,placeholder:{type:String,default:"請選擇種類"}},emits:["update:modelValue"],setup(C,{emit:U}){const h=V(!1),i=V([]),d=async()=>{h.value=!0;try{const r=await L.List();console.log("res",r),i.value=r.data.data}catch(r){console.log("fetch categories error",r)}finally{h.value=!1}};return re(()=>{d()}),(r,f)=>{const m=ie,t=de;return u(),S(t,{modelValue:C.modelValue,onClear:f[0]||(f[0]=g=>r.$emit("update:modelValue",null)),"onUpdate:modelValue":f[1]||(f[1]=g=>r.$emit("update:modelValue",g)),placeholder:C.placeholder,loading:e(h)},{default:s(()=>[(u(!0),b(N,null,T(e(i),g=>(u(),S(m,{key:g.id,label:g.name,value:g.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])}}},Te={key:0},ze={key:1},je={class:"ing-table"},Re={key:2},qe={__name:"EditProduct",emits:["update"],setup(C,{expose:U,emit:h}){const i=V(!1),d=V("基本資訊"),r=h,f=V(!1),m=V(null),t=q({id:null,name:"",category_id:"",price:0,description:"",ingredients:"",ingredient_details:[],imageUrls:[],is_active:!0}),g=()=>{X(()=>{m.value?.resetFields()})},w=(y={})=>{d.value="基本資訊",i.value=!0,y?.id?X(()=>{Object.assign(t,y)}):(t.id=null,g())},v=()=>{i.value=!1},c=async y=>{y.validate(o=>{if(o)k();else return})},k=async()=>{f.value=!0;try{let y;t.id?y=await R.Update(t.id,t):y=await R.Create(t),console.log("save product res",y),A({title:"成功",message:`商品已${t.id?"更新":"新增"}成功`,type:"success"}),v(),r("update")}catch(y){console.log("save product error",y)}finally{f.value=!1}},p=y=>{t.ingredient_details.splice(y,1)},$=async()=>{ne.confirm("確定要刪除此商品嗎？此操作無法恢復。","刪除確認",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(async()=>{f.value=!0;try{await R.Delete(t.id),A({title:"成功",message:"商品已刪除",type:"success"}),v(),r("update")}catch(y){console.log("delete product error",y),J.error("刪除商品失敗，請稍後再試")}finally{f.value=!1}}).catch(()=>{})};return U({open:w,close:v}),(y,o)=>{const I=ue,x=oe,_=te,z=Ne,P=Le,M=be,ce=he,me=Q("Delete"),pe=W,_e=Ve,j=K,ge=Me,ve=le,fe=ae;return u(),S(fe,{modelValue:e(i),"onUpdate:modelValue":o[11]||(o[11]=n=>O(i)?i.value=n:null),title:e(t).id?"編輯商品":"新增商品",width:"800px","append-to-body":""},{footer:s(()=>[a("div",{style:ke({display:"flex",justifyContent:e(t).id?"space-between":"center",alignItems:"center",width:"100%"})},[e(t).id?(u(),S(j,{key:0,type:"danger",plain:"",onClick:$,loading:e(f)},{default:s(()=>[...o[14]||(o[14]=[B(" 刪除商品 ",-1)])]),_:1},8,["loading"])):D("",!0),a("div",null,[l(j,{onClick:v},{default:s(()=>[...o[15]||(o[15]=[B("取消",-1)])]),_:1}),l(j,{type:"primary",onClick:o[10]||(o[10]=n=>c(e(m))),loading:e(f)},{default:s(()=>[B(E(e(t).id?"儲存":"新增"),1)]),_:1},8,["loading"])])],4)]),default:s(()=>[l(I,{modelValue:e(d),"onUpdate:modelValue":o[0]||(o[0]=n=>O(d)?d.value=n:null),options:["基本資訊","商品圖片","詳細成分"],block:""},null,8,["modelValue"]),o[16]||(o[16]=a("br",null,null,-1)),l(ve,{model:e(t),loading:e(f),ref_key:"formRef",ref:m,"label-width":"120px","label-position":"left"},{default:s(()=>[e(d)==="基本資訊"?(u(),b("div",Te,[l(_,{label:"產品名稱",required:"",prop:"name"},{default:s(()=>[l(x,{modelValue:e(t).name,"onUpdate:modelValue":o[1]||(o[1]=n=>e(t).name=n),placeholder:"產品名稱（例：原味軟法）"},null,8,["modelValue"])]),_:1}),l(_,{label:"產品類別",required:"",prop:"category_id"},{default:s(()=>[l(z,{modelValue:e(t).category_id,"onUpdate:modelValue":o[2]||(o[2]=n=>e(t).category_id=n)},null,8,["modelValue"])]),_:1}),l(_,{label:"產品定價",required:"",prop:"price"},{default:s(()=>[l(x,{modelValue:e(t).price,"onUpdate:modelValue":o[3]||(o[3]=n=>e(t).price=n),modelModifiers:{number:!0},style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(_,{label:"產品簡介",prop:"description"},{default:s(()=>[l(x,{modelValue:e(t).description,"onUpdate:modelValue":o[4]||(o[4]=n=>e(t).description=n),type:"textarea",rows:3,placeholder:"產品簡短介紹"},null,8,["modelValue"])]),_:1}),l(_,{label:"成分表",prop:"ingredients"},{default:s(()=>[l(x,{modelValue:e(t).ingredients,"onUpdate:modelValue":o[5]||(o[5]=n=>e(t).ingredients=n),type:"textarea",rows:3,placeholder:"例如：高筋麵粉、牛奶、酵母、鹽、糖"},null,8,["modelValue"])]),_:1}),l(_,{label:"狀態",required:"",prop:"is_active"},{default:s(()=>[l(P,{modelValue:e(t).is_active,"onUpdate:modelValue":o[6]||(o[6]=n=>e(t).is_active=n),placeholder:"選擇產品狀態"},null,8,["modelValue"])]),_:1})])):D("",!0),e(d)==="詳細成分"?(u(),b("div",ze,[a("div",je,[o[13]||(o[13]=a("small",{class:"hint"},"輸入成分與份量，可協助統計訂單所需原料。非必填欄位。",-1)),l(_e,{data:e(t).ingredient_details,border:"",size:"small"},{default:s(()=>[l(M,{label:"名稱",align:"center"},{default:s(({row:n})=>[l(x,{modelValue:n.name,"onUpdate:modelValue":F=>n.name=F,placeholder:"成分名稱"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(M,{label:"份量(公克)",width:"110",align:"center"},{default:s(({row:n})=>[l(x,{inputmode:"numeric",modelValue:n.grams,"onUpdate:modelValue":F=>n.grams=F,placeholder:"份量(公克)"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(M,{label:"顯示",width:"60",align:"center"},{default:s(({row:n})=>[l(ce,{size:"small",modelValue:n.is_visible,"onUpdate:modelValue":F=>n.is_visible=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(M,{label:"",width:"50",align:"center"},{default:s(({$index:n})=>[l(pe,{class:"delete-btn",onClick:F=>p(n)},{default:s(()=>[l(me)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(j,{type:"primary",plain:"",size:"small",onClick:o[7]||(o[7]=n=>e(t).ingredient_details.push({name:"",grams:"",is_visible:!0}))},{default:s(()=>[...o[12]||(o[12]=[B(" 新增 ",-1)])]),_:1})])])):D("",!0),e(d)==="商品圖片"?(u(),b("div",Re,[l(ge,{modelValue:e(t).imageUrls,"onUpdate:modelValue":o[8]||(o[8]=n=>e(t).imageUrls=n),disabled:!1,onUpload:o[9]||(o[9]=n=>{e(t).imageUrls=n})},null,8,["modelValue"])])):D("",!0)]),_:1},8,["model","loading"])]),_:1},8,["modelValue","title"])}}},Oe=G(qe,[["__scopeId","data-v-7aba2b07"]]),Ae={class:"products-manager"},Ge={class:"page-header"},He={class:"header-top"},Je={class:"toolbar"},Ke={class:"columns-2"},Qe=["src","alt"],We={key:1,class:"image-placeholder"},Xe={key:2,class:"overlay"},Ye={class:"category"},Ze={class:"info"},el={class:"title"},ll={class:"text-ellipsis-2"},tl={class:"description text-ellipsis-2"},ol={class:"price"},al={__name:"products",setup(C){const U=V(),h=V(),i=V(null),d=V(!1),r={label:"name",value:"id"};q({page:null,limit:null,keyword:"",category_id:null});const f=V([{name:"全部",id:null}]),m=V([]),t=se(()=>i.value===null?m.value:m.value.filter(v=>v.category_id===i.value)),g=async()=>{d.value=!0;try{const v=await L.List();f.value=[{name:"全部",id:null},...v.data.data]}catch(v){console.log("catch",v)}finally{d.value=!1}},w=async()=>{d.value=!0;try{const v=await R.List();console.log("products",v),m.value=v.data.data}catch(v){console.log("catch",v)}finally{d.value=!1}};return re(()=>{g(),w()}),(v,c)=>{const k=K,p=Pe,$=ue,y=Q("MoreFilled"),o=W,I=Z,x=ee;return u(),b("div",Ae,[a("div",Ge,[a("div",He,[c[4]||(c[4]=a("div",null,[a("h2",null,"產品管理"),a("p",{class:"subtitle"},"管理麵包產品資訊，快速編輯與分類")],-1)),l(k,{type:"primary",icon:"Plus",onClick:c[0]||(c[0]=_=>e(h).open())},{default:s(()=>[...c[3]||(c[3]=[B(" 新增產品 ",-1)])]),_:1})])]),l(p,{ref_key:"editCategory",ref:U},null,512),l(Oe,{ref_key:"editProduct",ref:h,onUpdate:w},null,512),a("div",Je,[Y(l($,{modelValue:e(i),"onUpdate:modelValue":c[1]||(c[1]=_=>O(i)?i.value=_:null),options:e(f),props:r},null,8,["modelValue","options"]),[[x,e(d)]]),l(k,{icon:"setting",text:"",onClick:c[2]||(c[2]=_=>e(U).open())})]),a("div",Ke,[(u(!0),b(N,null,T(e(t),_=>(u(),b("div",{class:"card",key:_.id},[a("div",{class:H(["thumb",{disabled:!_.is_active}])},[_.image_url?(u(),b("img",{key:0,src:_.image_url,alt:_.name},null,8,Qe)):(u(),b("div",We,[...c[5]||(c[5]=[a("span",null,"No Image",-1)])])),_.is_active?D("",!0):(u(),b("div",Xe,"下架")),a("div",Ye,E(_.category_name),1)],2),a("div",Ze,[a("div",el,[a("span",ll,E(_.name),1),l(o,{onClick:z=>e(h).open(_)},{default:s(()=>[l(y)]),_:1},8,["onClick"])]),a("p",tl,E(_.description),1),a("span",ol,"$"+E(_.price),1)])]))),128))]),e(t).length===0?(u(),S(I,{key:0,description:"沒有符合條件的產品"})):D("",!0)])}}},ml=G(al,[["__scopeId","data-v-45f0bd20"]]);export{ml as default};
